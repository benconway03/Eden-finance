<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Stock Graphing · EDEN FINANCE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="{{ url_for('static', filename='styles.css') }}" rel="stylesheet">
  </head>

  <body>
    <!-- Sidebar (reuse same structure as index.html) -->
    <aside class="sidebar">
      <h1>EDEN FINANCE</h1>
      <nav>
        <ul>
          <li><a href="{{ url_for('index') }}">Home</a></li>
          <li>
            <a href="#" class="dropdown-btn">Pages ▼</a>
            <ul class="dropdown-container">
              <li><a href="{{ url_for('contact') }}">Contact</a></li>
              <li><a href="{{ url_for('stocks') }}">Stock Graphing</a></li>
            </ul>
          </li>
        </ul>
      </nav>
    </aside>

    <!-- Main content -->
    <main class="main-content">
      <div class="card">
        <h2>Stock Graphing</h2>

        {% if error %}
          <p class="alert error">{{ error }}</p>
        {% endif %}

        <form method="post">
          <div class="row">
            <label>Start&nbsp;<input type="date" name="start_date" value="{{ start_default }}"></label>
            <label>End&nbsp;<input type="date" name="end_date" value="{{ end_default }}"></label>
          </div>

          <div id="rows">
            <div class="row">
              <input name="ticker[]" placeholder="Ticker">
              <input name="amount[]" placeholder="£ Start Amount">
            </div>
          </div>

          <div class="buttons">
            <button type="button" id="addRow" class="ghost">+ Add holding</button>
            <button type="submit" class="primary">Plot growth →</button>
          </div>
        </form>

        {% if plot_url %}
          <h2 class="subheading">Result</h2>
          <img class="plot" src="data:image/png;base64,{{ plot_url }}" alt="Growth chart">
        {% endif %}
      </div>
    </main>

    <footer class="footer">
      &copy; Eden Finance. All rights reserved.
    </footer>

    <script>
      // duplicate the first row on click
      document.getElementById('addRow').onclick = () => {
        document.getElementById('rows').insertAdjacentHTML('beforeend', `
          <div class="row">
            <input name="ticker[]" placeholder="Ticker">
            <input name="amount[]" placeholder="£ Start Amount">
          </div>`);
      };

      // Sidebar dropdown toggle
      const dropdownBtns = document.querySelectorAll(".dropdown-btn");
      dropdownBtns.forEach(btn => {
        btn.addEventListener("click", () => {
          btn.classList.toggle("active");
          const container = btn.nextElementSibling;
          if(container.style.display === "flex") {
            container.style.display = "none";
          } else {
            container.style.display = "flex";
          }
        });
      });
    </script>
  </body>
</html>
